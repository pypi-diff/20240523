# Comparing `tmp/bigeye_airflow-0.1.8-py3-none-any.whl.zip` & `tmp/bigeye_airflow-0.1.9-py3-none-any.whl.zip`

## zipinfo {}

```diff
@@ -1,24 +1,24 @@
-Zip file size: 10814 bytes, number of entries: 22
--rw-rw-r--  2.0 unx        0 b- defN 22-May-18 03:11 bigeye_airflow/__init__.py
--rw-rw-r--  2.0 unx     1148 b- defN 22-May-19 02:22 bigeye_airflow/airflow_datawatch_client.py
--rw-rw-r--  2.0 unx        0 b- defN 22-May-18 03:11 bigeye_airflow/airflow_ext/__init__.py
--rw-rw-r--  2.0 unx     1491 b- defN 22-May-18 03:11 bigeye_airflow/airflow_ext/bigeye_airflow_httphook.py
--rw-rw-r--  2.0 unx        0 b- defN 22-May-18 03:11 bigeye_airflow/aws/__init__.py
--rw-rw-r--  2.0 unx        1 b- defN 22-May-18 03:11 bigeye_airflow/aws/s3_utils.py
--rw-rw-r--  2.0 unx        1 b- defN 22-May-18 03:11 bigeye_airflow/bigeye_requests/__init__.py
--rw-rw-r--  2.0 unx     2433 b- defN 22-May-18 03:11 bigeye_airflow/bigeye_requests/catalog_requests.py
--rw-rw-r--  2.0 unx      168 b- defN 22-May-18 03:11 bigeye_airflow/bigeye_requests/http_hook.py
--rw-rw-r--  2.0 unx     1890 b- defN 22-May-18 03:11 bigeye_airflow/bigeye_requests/metric_requests.py
--rw-rw-r--  2.0 unx        0 b- defN 22-May-18 03:11 bigeye_airflow/functions/__init__.py
--rw-rw-r--  2.0 unx        0 b- defN 22-May-18 03:11 bigeye_airflow/models/__init__.py
--rw-rw-r--  2.0 unx      986 b- defN 22-May-18 03:11 bigeye_airflow/models/configurations.py
--rw-rw-r--  2.0 unx        0 b- defN 22-May-18 03:11 bigeye_airflow/operators/__init__.py
--rw-rw-r--  2.0 unx      261 b- defN 22-May-19 02:13 bigeye_airflow/operators/client_extensible_operator.py
--rw-rw-r--  2.0 unx     2097 b- defN 22-May-19 02:22 bigeye_airflow/operators/create_metric_operator.py
--rw-rw-r--  2.0 unx     1622 b- defN 22-May-19 02:22 bigeye_airflow/operators/create_sla_operator.py
--rw-rw-r--  2.0 unx     4199 b- defN 22-May-19 02:22 bigeye_airflow/operators/run_metrics_operator.py
--rw-rw-r--  2.0 unx     1024 b- defN 22-May-19 16:42 bigeye_airflow-0.1.8.dist-info/METADATA
--rw-rw-r--  2.0 unx       92 b- defN 22-May-19 16:42 bigeye_airflow-0.1.8.dist-info/WHEEL
--rw-rw-r--  2.0 unx       15 b- defN 22-May-19 16:42 bigeye_airflow-0.1.8.dist-info/top_level.txt
-?rw-rw-r--  2.0 unx     2071 b- defN 22-May-19 16:42 bigeye_airflow-0.1.8.dist-info/RECORD
-22 files, 19499 bytes uncompressed, 7316 bytes compressed:  62.5%
+Zip file size: 11079 bytes, number of entries: 22
+-rw-rw-r--  2.0 unx        0 b- defN 22-Jul-21 18:39 bigeye_airflow/__init__.py
+-rw-rw-r--  2.0 unx     1148 b- defN 22-Jul-21 18:39 bigeye_airflow/airflow_datawatch_client.py
+-rw-rw-r--  2.0 unx        0 b- defN 22-Jul-21 18:39 bigeye_airflow/airflow_ext/__init__.py
+-rw-rw-r--  2.0 unx     1491 b- defN 22-Jul-21 18:39 bigeye_airflow/airflow_ext/bigeye_airflow_httphook.py
+-rw-rw-r--  2.0 unx        0 b- defN 22-Jul-21 18:39 bigeye_airflow/aws/__init__.py
+-rw-rw-r--  2.0 unx        1 b- defN 22-Jul-21 18:39 bigeye_airflow/aws/s3_utils.py
+-rw-rw-r--  2.0 unx        1 b- defN 22-Jul-21 18:39 bigeye_airflow/bigeye_requests/__init__.py
+-rw-rw-r--  2.0 unx     2433 b- defN 22-Jul-21 18:39 bigeye_airflow/bigeye_requests/catalog_requests.py
+-rw-rw-r--  2.0 unx      168 b- defN 22-Jul-21 18:39 bigeye_airflow/bigeye_requests/http_hook.py
+-rw-rw-r--  2.0 unx     1890 b- defN 22-Jul-21 18:39 bigeye_airflow/bigeye_requests/metric_requests.py
+-rw-rw-r--  2.0 unx        0 b- defN 22-Jul-21 18:39 bigeye_airflow/functions/__init__.py
+-rw-rw-r--  2.0 unx        0 b- defN 22-Jul-21 18:39 bigeye_airflow/models/__init__.py
+-rw-rw-r--  2.0 unx      986 b- defN 22-Jul-21 18:39 bigeye_airflow/models/configurations.py
+-rw-rw-r--  2.0 unx        0 b- defN 22-Jul-21 18:39 bigeye_airflow/operators/__init__.py
+-rw-rw-r--  2.0 unx      261 b- defN 22-Jul-21 18:39 bigeye_airflow/operators/client_extensible_operator.py
+-rw-rw-r--  2.0 unx     2914 b- defN 22-Aug-03 14:42 bigeye_airflow/operators/create_metric_operator.py
+-rw-rw-r--  2.0 unx     1622 b- defN 22-Jul-21 18:39 bigeye_airflow/operators/create_sla_operator.py
+-rw-rw-r--  2.0 unx     4198 b- defN 22-Aug-03 14:42 bigeye_airflow/operators/run_metrics_operator.py
+-rw-rw-r--  2.0 unx     1024 b- defN 22-Aug-03 14:43 bigeye_airflow-0.1.9.dist-info/METADATA
+-rw-rw-r--  2.0 unx       92 b- defN 22-Aug-03 14:43 bigeye_airflow-0.1.9.dist-info/WHEEL
+-rw-rw-r--  2.0 unx       15 b- defN 22-Aug-03 14:43 bigeye_airflow-0.1.9.dist-info/top_level.txt
+?rw-rw-r--  2.0 unx     2071 b- defN 22-Aug-03 14:43 bigeye_airflow-0.1.9.dist-info/RECORD
+22 files, 20315 bytes uncompressed, 7581 bytes compressed:  62.7%
```

## zipnote {}

```diff
@@ -48,20 +48,20 @@
 
 Filename: bigeye_airflow/operators/create_sla_operator.py
 Comment: 
 
 Filename: bigeye_airflow/operators/run_metrics_operator.py
 Comment: 
 
-Filename: bigeye_airflow-0.1.8.dist-info/METADATA
+Filename: bigeye_airflow-0.1.9.dist-info/METADATA
 Comment: 
 
-Filename: bigeye_airflow-0.1.8.dist-info/WHEEL
+Filename: bigeye_airflow-0.1.9.dist-info/WHEEL
 Comment: 
 
-Filename: bigeye_airflow-0.1.8.dist-info/top_level.txt
+Filename: bigeye_airflow-0.1.9.dist-info/top_level.txt
 Comment: 
 
-Filename: bigeye_airflow-0.1.8.dist-info/RECORD
+Filename: bigeye_airflow-0.1.9.dist-info/RECORD
 Comment: 
 
 Zip file comment:
```

## bigeye_airflow/operators/create_metric_operator.py

```diff
@@ -1,13 +1,13 @@
 import logging
 from typing import List
 
-from bigeye_sdk.client.datawatch_client import DatawatchClient
+from bigeye_sdk.model.metric_facade import SimpleUpsertMetricRequest
 
-from bigeye_sdk.model.configuration_templates import SimpleUpsertMetricRequest
+from bigeye_sdk.client.datawatch_client import DatawatchClient
 
 from bigeye_airflow.airflow_datawatch_client import AirflowDatawatchClient
 from bigeye_airflow.operators.client_extensible_operator import ClientExtensibleOperator
 
 
 class CreateMetricOperator(ClientExtensibleOperator):
     """
@@ -15,44 +15,64 @@
     business logic of Bigeye's API.
     """
 
     def __init__(self,
                  connection_id: str,
                  warehouse_id: int,
                  configuration: List[dict],
+                 run_after_upsert: bool = False,
                  *args,
                  **kwargs):
         """
         param connection_id: string referencing a defined connection in the Airflow deployment.
         param warehouse_id: int id of the warehouse where the operator will upsert the metrics.
         param configuration: list of metric configurations to upsert.  The dicts passed as a list must conform to the
-        dataclass SimpleMetricTemplate.
+        dataclass SimplePredefinedMetricTemplate.
         param args: not currently supported
         param kwargs: not currently supported
         """
 
         super(CreateMetricOperator, self).__init__(*args, **kwargs)
         self.connection_id = connection_id
-        self.warehouse_id = warehouse_id
 
-        self.configuration = [SimpleUpsertMetricRequest.from_dict(c)
-                              for c in configuration]
+        self.configuration: List[SimpleUpsertMetricRequest] = []
+
+        for c in configuration:
+            c['warehouse_id'] = warehouse_id
+            self.configuration.append( SimpleUpsertMetricRequest.from_dict(c))
 
         self.connection_id = connection_id
         self.client = None
 
+        self.run_after_upsert = run_after_upsert
+
     def get_client(self) -> DatawatchClient:
         if not self.client:
             self.client = AirflowDatawatchClient(self.connection_id)
         return self.client
 
     def execute(self, context):
+
+        num_failing_metric_runs = 0
         created_metrics_ids: List[int] = []
 
         # Iterate each configuration
         for c in self.configuration:
 
-            r = self.get_client().upsert_metric_from_simple_template(sumr=c, target_warehouse_id=self.warehouse_id)
-            created_metrics_ids.append(r)
+            metric_id = self.get_client().upsert_metric_from_simple_template(sumr=c)
+            created_metrics_ids.append(metric_id)
+
+            if self.run_after_upsert and metric_id is not None:
+                hook = self.get_hook('GET')
+                logging.info(f"Running metric ID: {metric_id}")
+                metric_result = hook.run(
+                    f"statistics/runOne/{metric_id}",
+                    headers={"Content-Type": "application/json", "Accept": "application/json"}).json()
+
+                for mr in metric_result:
+                    if not mr['statusOk']:
+                        logging.error("Metric is not OK: %s", metric_id)
+                        logging.error("Metric result: %s", mr)
+                        num_failing_metric_runs += 1
 
         return created_metrics_ids
```

## bigeye_airflow/operators/run_metrics_operator.py

```diff
@@ -39,15 +39,15 @@
         """
         super(RunMetricsOperator, self).__init__(*args, **kwargs)
         self.connection_id = connection_id
         self.warehouse_id = warehouse_id
         self.schema_name = schema_name
         self.table_name = table_name
         self.metric_ids = metric_ids
-        self.connection_id = connection_id;
+        self.connection_id = connection_id
         self.client = None
 
     def get_client(self) -> DatawatchClient:
         if not self.client:
             self.client = AirflowDatawatchClient(self.connection_id)
         return self.client
```

## Comparing `bigeye_airflow-0.1.8.dist-info/METADATA` & `bigeye_airflow-0.1.9.dist-info/METADATA`

 * *Files 0% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: bigeye-airflow
-Version: 0.1.8
+Version: 0.1.9
 Summary: Airflow operators to be used with Bigeye
 Home-page: https://github.com/torodata/toro-airflow
 Author: Bigeye
 Author-email: support@bigeye.com
 License: UNKNOWN
 Platform: UNKNOWN
 Classifier: Programming Language :: Python :: 3
```

## Comparing `bigeye_airflow-0.1.8.dist-info/RECORD` & `bigeye_airflow-0.1.9.dist-info/RECORD`

 * *Files 5% similar despite different names*

```diff
@@ -9,14 +9,14 @@
 bigeye_airflow/bigeye_requests/http_hook.py,sha256=CTvdW70uFpkMl6ClV1BidVOOpjxcGCo9hrH43QQu0yo,168
 bigeye_airflow/bigeye_requests/metric_requests.py,sha256=c3MhzNFBMVT0U_OECCcVDn2BGhmH9Fn1ySDNuVppD-k,1890
 bigeye_airflow/functions/__init__.py,sha256=47DEQpj8HBSa-_TImW-5JCeuQeRkm5NMpJWZG3hSuFU,0
 bigeye_airflow/models/__init__.py,sha256=47DEQpj8HBSa-_TImW-5JCeuQeRkm5NMpJWZG3hSuFU,0
 bigeye_airflow/models/configurations.py,sha256=_gzPgUxX6RIa3V3KybngKsorT299v9yclwuzUzqmJ70,986
 bigeye_airflow/operators/__init__.py,sha256=47DEQpj8HBSa-_TImW-5JCeuQeRkm5NMpJWZG3hSuFU,0
 bigeye_airflow/operators/client_extensible_operator.py,sha256=LqSbP1CLoK_Br0sHEayQ05UiNyfr588pRdhL6hZcK1A,261
-bigeye_airflow/operators/create_metric_operator.py,sha256=7zv77q4MPEErjA_tgXVRADHT0jFe5Oj5qGGmuj7rYGc,2097
+bigeye_airflow/operators/create_metric_operator.py,sha256=SgHtc_9TTxHN34kaMjDja9wrH0eZxLNF6NlRvqT7Ghc,2914
 bigeye_airflow/operators/create_sla_operator.py,sha256=M9-mWbb_2Pxviy0pS349IQQQCnSdRBXJx5TZBZS3BMY,1622
-bigeye_airflow/operators/run_metrics_operator.py,sha256=-BlmTDyVgertj07Hg8JXFHuyrQVJLygSAbGi_BhscVc,4199
-bigeye_airflow-0.1.8.dist-info/METADATA,sha256=4MfN2VNUR3mEgPm0_YxkNlgOW0OXpp9EYoxVgxwNT3o,1024
-bigeye_airflow-0.1.8.dist-info/WHEEL,sha256=G16H4A3IeoQmnOrYV4ueZGKSjhipXx8zc8nu9FGlvMA,92
-bigeye_airflow-0.1.8.dist-info/top_level.txt,sha256=_YRhMJCAT70f2qvBqCaCSv0-Bx7Z6itfjicX5hcHqpY,15
-bigeye_airflow-0.1.8.dist-info/RECORD,,
+bigeye_airflow/operators/run_metrics_operator.py,sha256=XDlcykt-9kXqtSNSkkXkuaO2PDonvwwhn5_PZsePdNY,4198
+bigeye_airflow-0.1.9.dist-info/METADATA,sha256=_AOoebMxO3O20etnb8muRGHkj0MjRvl3BLTfULzHZXs,1024
+bigeye_airflow-0.1.9.dist-info/WHEEL,sha256=G16H4A3IeoQmnOrYV4ueZGKSjhipXx8zc8nu9FGlvMA,92
+bigeye_airflow-0.1.9.dist-info/top_level.txt,sha256=_YRhMJCAT70f2qvBqCaCSv0-Bx7Z6itfjicX5hcHqpY,15
+bigeye_airflow-0.1.9.dist-info/RECORD,,
```

